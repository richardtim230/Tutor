<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CODECX Student Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS + Flowbite -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/flowbite@1.6.5/dist/flowbite.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    .sidebar-active {
      background: linear-gradient(90deg, #6366f1 0%, #818cf8 100%);
      color: #fff !important;
    }
    .sidebar-link:hover {
      background: #eef2ff;
      color: #6366f1;
    }
    .sidebar::-webkit-scrollbar { display: none; }
    .sidebar { -ms-overflow-style: none; scrollbar-width: none; }
    .flowbite-modal { z-index: 1000 !important; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex">
  <!-- Sidebar -->
  <aside class="sidebar w-64 bg-white shadow-lg flex flex-col px-4 py-6 min-h-screen fixed top-0 left-0 z-20 transition-transform duration-200 xl:translate-x-0 -translate-x-full xl:static xl:block" id="sidebar">
    <!-- Profile Quick Info -->
    <div class="flex flex-col items-center mb-10">
      <img id="studentAvatar" src="https://flowbite.com/docs/images/people/profile-picture-5.jpg" alt="avatar" class="w-16 h-16 rounded-full border-2 border-indigo-500 mb-3">
      <div class="text-lg font-bold text-indigo-700" id="studentNameHeader">Student Name</div>
      <div class="text-xs text-gray-400" id="studentMatric">MAT123456</div>
    </div>
    <!-- Navigation Links -->
    <nav class="flex-1">
      <ul class="space-y-1">
        <li><a href="#" class="sidebar-link flex items-center px-3 py-2 rounded-lg font-medium text-gray-700" data-section="dashboard"><i class="bi bi-house-door-fill mr-3"></i>Dashboard</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-3 py-2 rounded-lg font-medium text-gray-700" data-section="assignments"><i class="bi bi-file-earmark-arrow-up-fill mr-3"></i>Assignments</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-3 py-2 rounded-lg font-medium text-gray-700" data-section="courses"><i class="bi bi-journal-code mr-3"></i>Courses</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-3 py-2 rounded-lg font-medium text-gray-700" data-section="masterclass"><i class="bi bi-lightbulb-fill mr-3"></i>Masterclass</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-3 py-2 rounded-lg font-medium text-gray-700" data-section="payments"><i class="bi bi-credit-card-2-front-fill mr-3"></i>Payments</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-3 py-2 rounded-lg font-medium text-gray-700" data-section="progress"><i class="bi bi-bar-chart-fill mr-3"></i>Progress</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-3 py-2 rounded-lg font-medium text-gray-700" data-section="chat"><i class="bi bi-chat-dots-fill mr-3"></i>Community & Chat</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-3 py-2 rounded-lg font-medium text-gray-700" data-section="notes"><i class="bi bi-pencil-square mr-3"></i>Admin Notes</a></li>
        <li><a href="#" class="sidebar-link flex items-center px-3 py-2 rounded-lg font-medium text-gray-700" data-section="activity"><i class="bi bi-clock-history mr-3"></i>Activity</a></li>
      </ul>
    </nav>
    <!-- Logout & Dark Mode -->
    <div class="mt-8 flex flex-col items-center">
      <button onclick="logout()" class="w-full px-3 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 mb-2"><i class="bi bi-box-arrow-right mr-2"></i>Logout</button>
      <button onclick="toggleDarkMode()" class="w-full px-3 py-2 rounded-lg bg-gray-200 text-gray-800 font-medium hover:bg-gray-300"><i class="bi bi-moon-stars mr-2"></i>Dark Mode</button>
    </div>
  </aside>
  <!-- Responsive Toggle (Mobile) -->
  <button class="xl:hidden fixed top-4 left-4 z-30 bg-indigo-600 text-white rounded-full p-2 shadow-lg" onclick="toggleSidebar()" id="sidebarToggle"><i class="bi bi-list"></i></button>
  <!-- Main Content Area -->
  <div class="flex-1 xl:ml-64 ml-0 transition-all pt-6 px-4" id="mainContent">
    <div id="sectionContent"></div>
  </div>
  <!-- Assignment Preview Modal -->
  <div id="assignmentModal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 w-full md:inset-0 h-modal md:h-full flowbite-modal">
    <div class="relative p-4 w-full max-w-xl h-full md:h-auto mx-auto">
      <div class="relative bg-white rounded-lg shadow dark:bg-gray-800">
        <div class="flex justify-between items-center p-4 border-b rounded-t dark:border-gray-600">
          <h3 class="text-lg font-semibold text-indigo-700 dark:text-white" id="assignmentModalTitle">Assignment Preview</h3>
          <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white" onclick="closeAssignmentModal()">
            <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"><path d="M10 8.586l4.95-4.95a1 1 0 111.414 1.414L11.414 10l4.95 4.95a1 1 0 01-1.414 1.414L10 11.414l-4.95 4.95a1 1 0 01-1.414-1.414L8.586 10l-4.95-4.95a1 1 0 011.414-1.414L10 8.586z"/></svg>
          </button>
        </div>
        <div class="p-6" id="assignmentModalBody">
          <!-- Preview HTML will be injected here -->
        </div>
      </div>
    </div>
  </div>
  <!-- Flowbite JS -->
  <script src="https://cdn.jsdelivr.net/npm/flowbite@1.6.5/dist/flowbite.min.js"></script>
  <!-- Dashboard JS (Sidebar, Section Loader, Modal, Dark Mode) -->
  <script>
    // Sidebar navigation logic
    const sidebarLinks = document.querySelectorAll('.sidebar-link');
    function activateSidebar(section) {
      sidebarLinks.forEach(link => {
        link.classList.remove('sidebar-active');
        if (link.dataset.section === section) link.classList.add('sidebar-active');
      });
    }
    // Sidebar toggle for mobile
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('-translate-x-full');
    }
    // Dark Mode Toggle
    function toggleDarkMode() {
      document.documentElement.classList.toggle('dark');
    }
    // Section Loader
    function loadSection(section) {
      activateSidebar(section);
      // Fill with HTML for each section
      let html = '';
      switch(section) {
        case 'dashboard':
          html = `
          <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            <div class="bg-white rounded-xl shadow p-6 flex flex-col items-center text-center">
              <img id="studentPassport" src="https://flowbite.com/docs/images/people/profile-picture-5.jpg" class="w-20 h-20 rounded-full mb-2 border-2 border-indigo-200"/>
              <h2 class="text-xl font-bold text-indigo-700" id="studentFullName">Student Name</h2>
              <div class="text-gray-500 mb-2" id="studentEmail">student@mail.com</div>
              <div id="studentPhone" class="text-sm text-gray-400">+234123456789</div>
              <span id="studentStatus" class="inline-block mt-3 px-3 py-1 rounded text-sm font-semibold bg-green-100 text-green-800">Active</span>
            </div>
            <div class="bg-white rounded-xl shadow p-6 flex flex-col justify-center">
              <h3 class="text-lg font-semibold text-gray-800 mb-2">Today's Progress</h3>
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div class="bg-indigo-600 h-4 rounded-full" style="width: 60%;"></div>
              </div>
              <div class="text-xs text-gray-500">60% of daily tasks completed</div>
            </div>
            <div class="bg-white rounded-xl shadow p-6 flex flex-col justify-center">
              <h3 class="text-lg font-semibold text-gray-800 mb-2">Masterclass Access</h3>
              <div class="flex items-center gap-2">
                <span class="inline-block px-3 py-1 rounded text-sm font-semibold bg-indigo-100 text-indigo-800">Unlocked</span>
                <span class="text-xs text-gray-500">All resources available</span>
              </div>
            </div>
          </div>
          `;
          break;
        case 'assignments':
          html = `
          <div class="max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Assignment Submission</h2>
            <form id="assignmentForm" class="bg-white rounded-xl shadow p-6 mb-6">
              <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">Choose File</label>
                <input type="file" id="assignmentFile" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/>
              </div>
              <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700">Submit Assignment</button>
            </form>
            <h2 class="text-xl font-semibold text-gray-700 mb-2">Assignment History</h2>
            <div id="assignmentHistory" class="space-y-4"></div>
          </div>
          `;
          break;
        case 'courses':
          html = `
          <div class="max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Courses</h2>
            <ul id="courseList" class="space-y-3">
              <li class="bg-white rounded-lg shadow p-4 flex items-center justify-between">
                <span class="font-semibold text-gray-800">Frontend Development</span>
                <span class="px-3 py-1 rounded bg-green-100 text-green-800 text-xs">Active</span>
              </li>
              <li class="bg-white rounded-lg shadow p-4 flex items-center justify-between">
                <span class="font-semibold text-gray-800">Backend API</span>
                <span class="px-3 py-1 rounded bg-indigo-100 text-indigo-800 text-xs">Active</span>
              </li>
            </ul>
          </div>
          `;
          break;
        case 'masterclass':
          html = `
          <div class="max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Masterclass</h2>
            <div class="bg-white rounded-xl shadow p-6 mb-4">
              <h3 class="text-lg font-semibold text-gray-800 mb-2">Live Session: "Building Real Projects"</h3>
              <div class="text-gray-500 mb-2">Next: Monday, 12PM WAT</div>
              <button class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700">Join Session</button>
            </div>
            <div class="bg-white rounded-xl shadow p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-2">Video Library</h3>
              <ul class="space-y-2">
                <li><a href="#" class="text-indigo-700 hover:underline">Intro to JavaScript</a></li>
                <li><a href="#" class="text-indigo-700 hover:underline">React Crash Course</a></li>
              </ul>
            </div>
          </div>
          `;
          break;
        case 'payments':
          html = `
          <div class="max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Payments</h2>
            <div class="bg-white rounded-xl shadow p-6 mb-4">
              <h3 class="text-lg font-semibold text-gray-800 mb-2">Payment Status</h3>
              <div class="flex items-center gap-2">
                <span class="inline-block px-3 py-1 rounded text-sm font-semibold bg-green-100 text-green-800">Paid</span>
                <span class="text-xs text-gray-500">Next renewal: Oct 1, 2025</span>
              </div>
            </div>
            <div class="bg-white rounded-xl shadow p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-2">Payment History</h3>
              <ul class="space-y-2">
                <li class="flex justify-between text-gray-700"><span>Sep 1, 2025</span><span>₦10,000</span></li>
                <li class="flex justify-between text-gray-700"><span>Aug 1, 2025</span><span>₦10,000</span></li>
              </ul>
            </div>
          </div>
          `;
          break;
        case 'progress':
          html = `
          <div class="max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Progress</h2>
            <div class="bg-white rounded-xl shadow p-6 mb-4">
              <h3 class="text-lg font-semibold text-gray-800 mb-2">Course Completion</h3>
              <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div class="bg-green-500 h-4 rounded-full" style="width: 70%;"></div>
              </div>
              <div class="text-xs text-gray-500">70% completed</div>
            </div>
            <div class="bg-white rounded-xl shadow p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-2">Daily Attendance</h3>
              <div class="grid grid-cols-7 gap-2">
                <span class="block w-8 h-8 bg-green-100 rounded text-center font-bold text-green-700">M</span>
                <span class="block w-8 h-8 bg-green-100 rounded text-center font-bold text-green-700">T</span>
                <span class="block w-8 h-8 bg-green-100 rounded text-center font-bold text-green-700">W</span>
                <span class="block w-8 h-8 bg-indigo-100 rounded text-center font-bold text-indigo-700">T</span>
                <span class="block w-8 h-8 bg-gray-100 rounded text-center font-bold text-gray-400">F</span>
                <span class="block w-8 h-8 bg-gray-100 rounded text-center font-bold text-gray-400">S</span>
                <span class="block w-8 h-8 bg-gray-100 rounded text-center font-bold text-gray-400">S</span>
              </div>
            </div>
          </div>
          `;
          break;
        case 'chat':
          html = `
          <div class="max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Community & Chat</h2>
            <div class="bg-white rounded-xl shadow p-6 h-80 flex flex-col">
              <div class="flex-1 overflow-y-auto mb-4" id="chatHistory">
                <div class="flex items-center mb-3">
                  <img src="https://flowbite.com/docs/images/people/profile-picture-5.jpg" class="w-8 h-8 rounded-full mr-2"/>
                  <div class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-lg">Welcome to CODECX!</div>
                </div>
                <div class="flex items-center mb-3 justify-end">
                  <div class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg">Thank you!</div>
                  <img src="https://flowbite.com/docs/images/people/profile-picture-5.jpg" class="w-8 h-8 rounded-full ml-2"/>
                </div>
              </div>
              <form id="chatForm" class="flex">
                <input type="text" class="flex-1 px-3 py-2 rounded-l-lg border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Type your message..."/>
                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-r-lg hover:bg-indigo-700"><i class="bi bi-send-fill"></i></button>
              </form>
            </div>
          </div>
          `;
          break;
        case 'notes':
          html = `
          <div class="max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Admin Notes</h2>
            <div class="bg-white rounded-xl shadow p-6">
              <div class="text-gray-700">No notes from admin yet.</div>
            </div>
          </div>
          `;
          break;
        case 'activity':
          html = `
          <div class="max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Recent Activity</h2>
            <div class="bg-white rounded-xl shadow p-6">
              <ul class="space-y-2">
                <li class="flex items-center gap-2 text-gray-700"><i class="bi bi-check-circle text-green-500"></i> Submitted assignment "Marketplace.jpg"</li>
                <li class="flex items-center gap-2 text-gray-700"><i class="bi bi-check-circle text-green-500"></i> Joined Masterclass session</li>
                <li class="flex items-center gap-2 text-gray-700"><i class="bi bi-check-circle text-green-500"></i> Made payment ₦10,000</li>
              </ul>
            </div>
          </div>
          `;
          break;
        default:
          html = `<div class="text-center text-gray-400">Select a section from the sidebar.</div>`;
      }
      document.getElementById('sectionContent').innerHTML = html;
      if (section === 'assignments') setupAssignmentSection();
    }
    // Initial load
    loadSection('dashboard');
    sidebarLinks.forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        loadSection(link.dataset.section);
      });
    });
    // Assignment Section Logic (mockup, plug in your backend)
    function setupAssignmentSection() {
      // Sample assignments
      const assignments = [
        {
          title: "Marketplace.jpg",
          fileName: "Marketplace.jpg",
          fileType: "image/jpeg",
          fileData: "/9j/4AAQSkZJRgABAQAAAQABAAD...", // Truncated base64
          historyDate: "2025-09-06T04:21:05Z",
          status: "Submitted"
        },
        {
          title: "project.pdf",
          fileName: "project.pdf",
          fileType: "application/pdf",
          fileData: "JVBERi0xLjQKJcfs...", // Truncated base64
          historyDate: "2025-08-30T10:15:00Z",
          status: "Submitted"
        }
      ];
      renderAssignmentHistory(assignments);
      document.getElementById('assignmentForm').onsubmit = function(e) {
        e.preventDefault();
        alert("Assignment submitted! (Wire up backend)");
      };
    }
    // Render Assignment History
    function renderAssignmentHistory(assignmentHistory) {
      const history = document.getElementById("assignmentHistory");
      if (!assignmentHistory || !assignmentHistory.length) {
        history.innerHTML = `<div class="text-gray-400 text-center">No assignments submitted yet.</div>`;
        return;
      }
      history.innerHTML = assignmentHistory.map((a, idx) => `
        <div class="flex flex-col md:flex-row items-center justify-between bg-white rounded-lg shadow px-4 py-2">
          <div class="flex items-center gap-4">
            <div>
              <span class="font-semibold text-gray-800">${a.title || a.fileName}</span>
              <span class="text-xs text-gray-400 ml-2">${a.status}</span>
            </div>
            <div class="text-xs text-gray-500 ml-2">${new Date(a.historyDate).toLocaleString()}</div>
          </div>
          <div class="flex gap-2 mt-2 md:mt-0">
            <button class="px-3 py-1 bg-indigo-50 text-indigo-700 rounded hover:bg-indigo-100 font-semibold" onclick="previewAssignmentHistory(${idx})">
              <i class="bi bi-eye-fill mr-1"></i> Preview
            </button>
            <a href="data:${a.fileType};base64,${a.fileData}" download="${a.fileName}" target="_blank" class="px-3 py-1 bg-green-50 text-green-700 rounded hover:bg-green-100 font-semibold">
              <i class="bi bi-download mr-1"></i> Download
            </a>
          </div>
        </div>
      `).join("");
      window.student = window.student || {};
      window.student.assignmentHistory = assignmentHistory;
    }
    // Assignment Preview Modal (advanced)
    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, function (m) {
        return (
          {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#39;"
          }[m]
        );
      });
    }
    function getExtension(filename) {
      return filename?.split('.').pop().toLowerCase();
    }
    function previewAssignmentHistory(index) {
      const assignment = (window.student?.assignmentHistory || [])[index];
      if (!assignment) return;
      const ext = getExtension(assignment.fileName);
      let previewHtml = "";
      if (assignment.fileType.startsWith("image/")) {
        previewHtml = `<img src="data:${assignment.fileType};base64,${assignment.fileData}" style="max-width:100%;max-height:300px;border-radius:9px;box-shadow:0 2px 16px #6366f155;" />`;
      } else if (assignment.fileType === "application/pdf") {
        previewHtml = `<iframe src="data:application/pdf;base64,${assignment.fileData}" width="100%" height="400" style="border-radius:8px;border:1px solid #eee;"></iframe>`;
      } else if (
        assignment.fileType.startsWith("text/") ||
        ["application/javascript", "text/html", "text/css"].includes(assignment.fileType) ||
        ["js", "css", "html", "txt"].includes(ext)
      ) {
        const decoded = atob(assignment.fileData);
        let codeType = ext;
        let codeBlock = "";
        if (ext === "html") {
          codeBlock += `<div style="margin-bottom:1.2em;">
            <span style="font-weight:600;color:#4338ca;">Live HTML Preview:</span>
            <iframe srcdoc="${escapeHtml(decoded)}" style="width:98%;height:160px;border:1px solid #eee;border-radius:7px;background:white;box-shadow:0 2px 12px #6366f122;"></iframe>
          </div>`;
          codeType = "html";
        }
        codeBlock += `<pre style="max-height:180px;overflow:auto;text-align:left;background:#f8fafc;border-radius:8px;padding:0.7em;font-size:0.97em;"><code class="language-${codeType}">${escapeHtml(decoded)}</code></pre>`;
        previewHtml = codeBlock;
      } else {
        previewHtml = `<div class="text-gray-500">Preview not available for this file type. Please download to view.</div>`;
      }
      const downloadLink = assignment.fileData
        ? `<a href="data:${assignment.fileType};base64,${assignment.fileData}" download="${assignment.fileName}" target="_blank"
          style="color:#6366f1;font-weight:bold;text-decoration:underline;">Download File</a>`
        : `<div class="text-gray-500">No download available.</div>`;
      let html = `<div style="text-align:center;">
        <h2 style="font-size:1.2rem;color:#6366f1;font-weight:700;">${assignment.title || assignment.fileName}</h2>
        <div style="margin:1rem 0;">Submitted: ${assignment.historyDate ? new Date(assignment.historyDate).toLocaleString() : ""}</div>
        <div style="margin-bottom:1rem;">${previewHtml}</div>
        <div style="margin-bottom:1.3em;">${downloadLink}</div>
        ${assignment.mark ? `<div>Mark: <b>${assignment.mark}</b></div>` : ""}
        ${assignment.status ? `<div>Status: <b>${assignment.status}</b></div>` : ""}
      </div>`;
      document.getElementById('assignmentModalTitle').textContent = "Assignment Preview";
      document.getElementById('assignmentModalBody').innerHTML = html;
      document.getElementById('assignmentModal').classList.remove('hidden');
    }
    function closeAssignmentModal() {
      document.getElementById('assignmentModal').classList.add('hidden');
    }
    // Logout (plug in your logic)
    function logout() {
      alert("Logged out! (Wire up your backend)");
    }
  </script>
</body>
</html>
