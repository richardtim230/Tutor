<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reset Password | CODECX INSTITUTE FOR DEVELOPERS</title>
  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" rel="stylesheet" />
  <!-- Flowbite CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
</head>
<body class="bg-gradient-to-br from-blue-50 to-blue-100 min-h-screen flex items-center justify-center">
  <div class="max-w-4xl w-full mx-4 bg-white/90 rounded-xl shadow-2xl flex flex-col md:flex-row overflow-hidden">
    <!-- Illustration / Info Panel -->
    <div class="hidden md:flex md:w-1/2 bg-gradient-to-br from-blue-600 to-blue-400 items-center justify-center p-8 relative">
      <div class="flex flex-col items-center">
        <!-- Modern SVG Illustration -->
        <svg width="180" height="180" viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg" class="mb-6">
          <circle cx="90" cy="90" r="90" fill="#3B82F6" opacity="0.15"/>
          <rect x="50" y="65" width="80" height="50" rx="10" fill="#fff" stroke="#3B82F6" stroke-width="2"/>
          <path d="M70 90v-7a10 10 0 0 1 20 0v7" stroke="#3B82F6" stroke-width="2" stroke-linecap="round"/>
          <rect x="80" y="97" width="20" height="6" rx="3" fill="#60A5FA"/>
          <circle cx="90" cy="90" r="3" fill="#3B82F6"/>
        </svg>
        <h2 class="text-white text-2xl font-semibold mb-2 text-center">Forgot your password?</h2>
        <p class="text-blue-50 text-center text-base">No worries! Enter your details to securely reset your password and regain access to your account.</p>
      </div>
    </div>
    <!-- Form Panel -->
    <div class="w-full md:w-1/2 p-8">
      <div class="mb-3">
        <h1 class="text-2xl md:text-3xl font-extrabold text-blue-700 mb-1 text-center md:text-left tracking-tight">CODECX INSTITUTE FOR DEVELOPERS</h1>
        <p class="text-lg text-blue-900 font-medium text-center md:text-left mb-4">Reset Password</p>
        <p class="text-gray-500 text-center md:text-left">Please provide your details to verify your identity and set a new password.</p>
      </div>
      <form id="resetForm" class="space-y-5">
        <!-- Full Name -->
        <div>
          <label for="fullName" class="block mb-2 text-sm font-medium text-gray-700">Full Name</label>
          <div class="relative">
            <span class="absolute left-3 top-3 text-blue-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M5.121 17.804A9 9 0 1112 21a9 9 0 01-6.879-3.196z" />
                <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </span>
            <input type="text" id="fullName" name="fullName" required class="block w-full pl-11 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400" placeholder="Enter your full name" />
          </div>
        </div>
        <!-- Matric Number -->
        <div>
          <label for="matricNo" class="block mb-2 text-sm font-medium text-gray-700">Matric Number</label>
          <div class="relative">
            <span class="absolute left-3 top-3 text-blue-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M8 7V3m8 4V3M3 11h18M5 21h14a2 2 0 002-2v-7H3v7a2 2 0 002 2z" />
              </svg>
            </span>
            <input type="text" id="matricNo" name="matricNo" required class="block w-full pl-11 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400" placeholder="Matriculation number" />
          </div>
        </div>
        <!-- Email -->
        <div>
          <label for="email" class="block mb-2 text-sm font-medium text-gray-700">Email Address</label>
          <div class="relative">
            <span class="absolute left-3 top-3 text-blue-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M16 12H8m8 0a4 4 0 10-8 0 4 4 0 008 0zM21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2v-7" />
              </svg>
            </span>
            <input type="email" id="email" name="email" required class="block w-full pl-11 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400" placeholder="Your email address" />
          </div>
        </div>
        <!-- Verify Button -->
        <button type="button" id="verifyBtn" class="w-full py-3 flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition relative" disabled>
          <span id="verifyBtnText">Verify Details</span>
          <svg id="verifySpinner" class="hidden animate-spin w-5 h-5 ml-2 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
          </svg>
        </button>
        <div id="detailsError" class="hidden">
          <div class="flex items-center p-3 mb-2 text-sm text-red-800 rounded-lg bg-red-50" role="alert">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 9v2m0 4h.01M21 12A9 9 0 113 12a9 9 0 0118 0z"/></svg>
            <span id="detailsErrorMsg"></span>
          </div>
        </div>
        <!-- Password Section -->
        <div id="passwordSection" class="hidden space-y-5">
          <hr class="my-2">
          <div>
            <label for="newPassword" class="block mb-2 text-sm font-medium text-gray-700">New Password</label>
            <div class="relative">
              <span class="absolute left-3 top-3 text-blue-500">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M12 15v2m0-6v2m-6 4V7a2 2 0 012-2h8a2 2 0 012 2v8a2 2 0 01-2 2H6a2 2 0 01-2-2z"/>
                </svg>
              </span>
              <input type="password" id="newPassword" name="newPassword" required class="block w-full pl-11 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400" placeholder="Enter new password">
            </div>
          </div>
          <div>
            <label for="confirmPassword" class="block mb-2 text-sm font-medium text-gray-700">Confirm Password</label>
            <div class="relative">
              <span class="absolute left-3 top-3 text-blue-500">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M5 13l4 4L19 7"/>
                </svg>
              </span>
              <input type="password" id="confirmPassword" name="confirmPassword" required class="block w-full pl-11 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400" placeholder="Repeat new password">
            </div>
          </div>
          <button type="submit" id="resetBtn" class="w-full py-3 flex items-center justify-center bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition relative">
            <span id="resetBtnText">Reset Password</span>
            <svg id="resetSpinner" class="hidden animate-spin w-5 h-5 ml-2 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
            </svg>
          </button>
          <div id="passwordError" class="hidden">
            <div class="flex items-center p-3 mb-2 text-sm text-red-800 rounded-lg bg-red-50" role="alert">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 9v2m0 4h.01M21 12A9 9 0 113 12a9 9 0 0118 0z"/></svg>
              <span id="passwordErrorMsg"></span>
            </div>
          </div>
        </div>
      </form>
      <div id="successMsg" class="hidden mt-6">
        <div class="flex items-center p-4 mb-2 text-sm text-green-800 rounded-lg bg-green-50" role="alert">
          <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>
          <span>Your password has been reset successfully!</span>
        </div>
        <div class="text-center mt-2 text-gray-700">
          <a href="/login" class="text-blue-600 hover:underline font-medium">Return to login</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Flowbite JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
  <script>
    const BACKEND_URL = "https://examguide.onrender.com/api/codecxreg";

    // Enable verify button only when all fields are filled
    function checkFields() {
      const fullName = document.getElementById('fullName').value.trim();
      const matricNo = document.getElementById('matricNo').value.trim();
      const email = document.getElementById('email').value.trim();
      document.getElementById('verifyBtn').disabled = !(fullName && matricNo && email);
    }

    document.getElementById('fullName').addEventListener('input', checkFields);
    document.getElementById('matricNo').addEventListener('input', checkFields);
    document.getElementById('email').addEventListener('input', checkFields);

    // Handle Verify Details
    document.getElementById('verifyBtn').addEventListener('click', async function() {
      const fullName = document.getElementById('fullName').value.trim();
      const matricNo = document.getElementById('matricNo').value.trim();
      const email = document.getElementById('email').value.trim();
      const errorDiv = document.getElementById('detailsError');
      const errorMsg = document.getElementById('detailsErrorMsg');
      const verifyBtn = this;
      const verifySpinner = document.getElementById('verifySpinner');
      const verifyBtnText = document.getElementById('verifyBtnText');

      // Spinner and button state
      verifyBtn.disabled = true;
      verifyBtnText.textContent = "Verifying...";
      verifySpinner.classList.remove('hidden');
      errorDiv.classList.add('hidden');

      try {
        // Call backend to verify details (CHANGE endpoint as needed)
        const resp = await fetch(`${BACKEND_URL}/student/forgot-password-init`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ fullName, matricNumber: matricNo, email })
        });
        const data = await resp.json();
        if (resp.ok && data.success !== false) {
          document.getElementById('passwordSection').classList.remove('hidden');
          verifyBtnText.textContent = "Verified";
          verifySpinner.classList.add('hidden');
          verifyBtn.classList.add('bg-gray-300', 'cursor-not-allowed');
        } else {
          errorMsg.textContent = data.message || "Details not found. Please check your input.";
          errorDiv.classList.remove('hidden');
          verifyBtn.disabled = false;
          verifyBtnText.textContent = "Verify Details";
          verifySpinner.classList.add('hidden');
        }
      } catch (e) {
        errorMsg.textContent = "Network error or server unavailable.";
        errorDiv.classList.remove('hidden');
        verifyBtn.disabled = false;
        verifyBtnText.textContent = "Verify Details";
        verifySpinner.classList.add('hidden');
      }
    });

    // Handle password reset submit
    document.getElementById('resetForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const fullName = document.getElementById('fullName').value.trim();
      const matricNo = document.getElementById('matricNo').value.trim();
      const email = document.getElementById('email').value.trim();
      const errorDiv = document.getElementById('passwordError');
      const errorMsg = document.getElementById('passwordErrorMsg');
      const resetBtn = document.getElementById('resetBtn');
      const resetSpinner = document.getElementById('resetSpinner');
      const resetBtnText = document.getElementById('resetBtnText');
      errorDiv.classList.add('hidden');

      // Client validation
      if (newPassword.length < 6) {
        errorMsg.textContent = "Password must be at least 6 characters.";
        errorDiv.classList.remove('hidden');
        return;
      }
      if (newPassword !== confirmPassword) {
        errorMsg.textContent = "Passwords do not match.";
        errorDiv.classList.remove('hidden');
        return;
      }

      resetBtn.disabled = true;
      resetBtnText.textContent = "Resetting...";
      resetSpinner.classList.remove('hidden');

      try {
        // Call backend to reset password (CHANGE endpoint as needed)
        const resp = await fetch(`${BACKEND_URL}/student/reset-password`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            fullName,
            matricNumber: matricNo,
            email,
            newPassword
          })
        });
        const data = await resp.json();
        if (resp.ok && data.success !== false) {
          document.getElementById('successMsg').classList.remove('hidden');
          document.getElementById('resetForm').classList.add('hidden');
        } else {
          errorMsg.textContent = data.message || "Could not reset password.";
          errorDiv.classList.remove('hidden');
          resetBtn.disabled = false;
          resetBtnText.textContent = "Reset Password";
          resetSpinner.classList.add('hidden');
        }
      } catch (e) {
        errorMsg.textContent = "Network error or server unavailable.";
        errorDiv.classList.remove('hidden');
        resetBtn.disabled = false;
        resetBtnText.textContent = "Reset Password";
        resetSpinner.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
